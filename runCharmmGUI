#!/bin/csh
#

# Generated by CHARMM-GUI (http://www.charmm-gui.org) v3.7

# This folder contains a pre-optimized PDB structure and OpenMM inputs.
# All input files were optimized for OpenMM v6.2 or above, so lower version of OpenMM can cause some errors.
# You can get the latest development version of OpenMM at the git repository:
# https://github.com/pandegroup/openmm

set init = step5_input
set equi_prefix = step6.%d_equilibration
set prod_prefix = step7_production
set prod_step   = step7

# Equilibration
set cnt = 1
while ( ${cnt} <= 6 )
    @ pcnt = ${cnt} - 1
    set istep = `printf ${equi_prefix} ${cnt}`
    set pstep = `printf ${equi_prefix} ${pcnt}`
    set input_param = "-t toppar.str -p ${init}.psf -c ${init}.crd"
    if ( ${cnt} == 1 ) set input_param = `echo "${input_param} -b sysinfo.dat"`
    if ( ${cnt} != 1 ) set input_param = `echo "${input_param} -irst ${pstep}.rst"`
    python -u openmm_run.py -i ${istep}.inp ${input_param} -orst ${istep}.rst -odcd Equilibration.dcd > ${istep}.out
    @ cnt += 1
end

# Production
# The OpenMM check point file (.chk) cannot be used in a different machine environment.
# So please make sure if you are using the same GPU and CUDA version of machine while doing additional
# production steps with the check point file.
set cnt = 1
set cntmax = 10


set istep = ${prod_step}_${cnt}
set pstep = ${prod_step}_${pcnt}
if ( ${cnt} == 1 ) set pstep = `printf ${equi_prefix} 6`
set input_param = "-t toppar.str -p ${init}.psf -c ${init}.crd -irst ${pstep}.rst"
python -u openmm_run.py -i ${prod_prefix}.inp ${input_param} -opdb Production.pdb -orst ${istep}.rst -odcd Production.dcd > ${istep}.out


